/*!
 * ====================================================
 * Kityformula-Editor - v1.0.0 - 2018-05-13
 * https://github.com/fex-team/kityformula-editor/ 
 * Copyright (c) 2018 Baidu Kity Group; Licensed MIT
 * ====================================================
 */
!function(){function a(a,b,c){if(d[a]={exports:{},value:null,factory:null},2===arguments.length&&(c=b),"[object Object]"===d.toString.call(c))d[a].value=c;else{if("function"!=typeof c)throw new Error("define函数未定义的行为");d[a].factory=c}}function b(a){var c=d[a],e=null;return c?c.value?c.value:(e=c.factory.call(null,b,c.exports,c),e&&(c.exports=e),c.value=c.exports,c.value):null}function c(a){return b(a)}var d={};a("base/common",[],function(a){function b(a,e,f,g){return g=0|g,g>c?f:(g++,d.each(f,function(c,f,h){a?!c||"object"!=typeof c&&"function"!=typeof c?e[f]=c:(e[f]=e[f]||(d.isArray(c)?[]:{}),e[f]=b(a,e[f],c,g)):e[f]=c}),e)}var c=10,d={extend:function(a,c){var e=!1;if("boolean"==typeof a?(e=a,a=c,c=[].splice.call(arguments,2)):c=[].splice.call(arguments,1),!a)throw new Error("Utils: extend, target can not be empty");return d.each(c,function(c){(c&&"object"==typeof c||"function"==typeof c)&&b(e,a,c)}),a},isArray:function(a){return a&&"[object Array]"==={}.toString.call(a)},isString:function(a){return"string"==typeof a},proxy:function(a,b){return function(){return a.apply(b,arguments)}},each:function(a,b){if(a)if("length"in a&&"number"==typeof a.length)for(var c=0,d=a.length;d>c&&b.call(null,a[c],c,a)!==!1;c++);else for(var e in a)if(a.hasOwnProperty(e)&&b.call(null,a[e],e,a)===!1)break}};return d}),a("base/event/event",["base/event/kfevent","base/common"],function(a,b,c){function d(){return++f}var e={},f=0,g=!0,h=a("base/event/kfevent"),i=a("base/common"),j=function(a){var b=a.type,c=a.target,d=this.__kfe_eid,f=/^(?:before|after)/.test(b),h=e[d][b];return f||(k.trigger(c,"before"+b),g!==!1)?(i.each(h,function(b,d){return b&&b.call(c,a)===!1?g=!1:void 0}),void(f||k.trigger(c,"after"+b))):(g=!0,!1)},k={addEvent:function(a,b,c){var f=!0,g=null;a.__kfe_eid||(f=!1,a.__kfe_eid=d(),e[a.__kfe_eid]={}),g=e[a.__kfe_eid],g[b]||(f=!1,g[b]=[]),g[b].push(c),f||a.addEventListener(b,j,!1)},trigger:function(a,b,c){c=c||h.createEvent(b,c),a.dispatchEvent(c)}};return k}),a("base/event/kfevent",[],function(a){return{createEvent:function(a,b){var c=document.createEvent("Event");return c.initEvent(a,!0,!0),c}}}),a("base/utils",["base/common","base/event/event","base/event/kfevent"],function(a){var b={},c=a("base/common");return c.extend(b,c,a("base/event/event")),b}),a("editor/editor",["kity","base/utils","base/common","base/event/event"],function(a){function b(a){var b=this.services[a];if(!b)throw new Error("KFEditor: not found service, "+a);return b}var c=a("kity"),d=a("base/utils"),e={controller:{zoom:!0,maxzoom:5,minzoom:.5},formula:{fontsize:50,autoresize:!1}},f={},g=c.createClass("KFEditor",{constructor:function(a,b){this.options=d.extend(!0,{},e,b),this.container=a,this.services={},this.commands={},this.initComponents()},getContainer:function(){return this.container},getOptions:function(){return this.options},initComponents:function(){var a=this;d.each(f,function(b){new b(a)})},requestService:function(a,c){var d=b.call(this,a);return d.service[d.key].apply(d.provider,[].slice.call(arguments,1))},request:function(a){var c=b.call(this,a);return c.service},registerService:function(a,b,c){var e=null;for(e in c)c[e]&&c.hasOwnProperty(e)&&(c[e]=d.proxy(c[e],b));this.services[a]={provider:b,key:e,service:c}},registerCommand:function(a,b,c){this.commands[a]={executor:b,execFn:c}},execCommand:function(a,b){var c=this.commands[a];if(!c)throw new Error("KFEditor: not found command, "+a);return c.execFn.apply(c.executor,[].slice.call(arguments,1))}});return d.extend(g,{registerComponents:function(a,b){f[a]=b}}),g}),a("jquery",[],function(){return window.jQuery}),a("kf-ext/def",[],function(){return{selectColor:"rgba(42, 106, 189, 0.2)",allSelectColor:"rgba(42, 106, 189, 0.6)"}}),a("kf-ext/expression/placeholder",["kity","kf","kf-ext/operator/placeholder","kf-ext/def"],function(a,b,c){var d=a("kity"),e=a("kf"),f=a("kf-ext/operator/placeholder");return d.createClass("PlaceholderExpression",{base:e.CompoundExpression,constructor:function(){this.callBase(),this.setFlag("Placeholder"),this.box.setAttr("data-type",null),this.setOperator(new f)},select:function(){this.getOperator().select()},selectAll:function(){this.getOperator().selectAll()},unselect:function(){this.getOperator().unselect()}})}),a("kf-ext/extension",["kf","kity","kf-ext/def","kf-ext/expression/placeholder","kf-ext/operator/placeholder"],function(a){function b(b){c.PlaceholderExpression=a("kf-ext/expression/placeholder"),c.Expression.prototype.select=function(){this.box.fill(d)},c.Expression.prototype.selectAll=function(){this.box.fill(e)},c.Expression.prototype.unselect=function(){this.box.fill("transparent")},b.getKFParser().expand({parse:{placeholder:{name:"placeholder",handler:function(a){return delete a.handler,a.operand=[],a},sign:!1}},reverse:{placeholder:function(){return"\\placeholder"}}})}var c=a("kf"),d=(a("kity"),a("kf-ext/def").selectColor),e=a("kf-ext/def").allSelectColor;return{ext:b}}),a("kf-ext/operator/placeholder",["kity","kf-ext/def","kf"],function(a,b,c){function d(){var a=13,b=17,c=null;return c=new e.Rect(a,b,0,0).stroke("black").fill("transparent").translate(2,6),c.setAttr("stroke-dasharray","1, 2"),c}var e=a("kity"),f=a("kf-ext/def").selectColor,g=a("kf-ext/def").allSelectColor;return e.createClass("PlaceholderOperator",{base:a("kf").Operator,constructor:function(){this.opShape=null,this.callBase("Placeholder")},applyOperand:function(){this.setBoxSize(17,27),this.opShape=d(),this.addOperatorShape(this.opShape)},select:function(){this.opShape.fill(f)},selectAll:function(){this.opShape.fill(g)},unselect:function(){this.opShape.fill("transparent")}})}),a("kf",[],function(){return window.kf}),a("kity",[],function(){return window.kity}),a("parse/def",[],function(){return{radical:!0,fraction:!0,summation:!0,integration:!0,placeholder:!0,script:!0,superscript:!0,subscript:!0,brackets:!0}}),a("parse/parser",["kf","kity","parse/def","kf-ext/extension","kf-ext/def","kf-ext/expression/placeholder"],function(a){function b(a,c,d){var e=null,g=!d;c.attr=c.attr||{},c.attr.id=a.getGroupId(),c.attr["data-type"]||(c.attr["data-type"]=h,f[c.name]&&(c.attr["data-type"]=i)),g&&(a.isResetId?c.attr["data-root"]="true":c.attr["data-type"]=i),"brackets"===c.name&&(c.attr["data-brackets"]="true");for(var j=0,k=c.operand.length;k>j;j++)e=c.operand[j],e?f[c.name]?"string"==typeof e?("brackets"!==c.name||j>1)&&(c.operand[j]={name:"combination",operand:[e],attr:{id:a.getGroupId(),"data-type":h}}):"combination"!==e.name?(c.operand[j]={name:"combination",operand:[null],attr:{id:a.getGroupId(),"data-type":h}},"placeholder"===e.name?(c.operand[j].operand[0]={name:"combination",operand:[e],attr:{id:a.getGroupId(),"data-type":h,"data-placeholder":"true"}},e.attr={id:a.getGroupId()}):c.operand[j].operand[0]=b(a,e,c.operand[j])):(e.attr={"data-type":h},c.operand[j]=b(a,e,c)):"string"==typeof e?c.operand[j]=e:"placeholder"===e.name?(c.operand[j]={name:"combination",operand:[e],attr:{id:a.getGroupId(),"data-type":h,"data-placeholder":"true"}},e.attr={id:a.getGroupId()}):c.operand[j]=b(a,e,c):c.operand[j]=e;return c}function c(){return g+ ++j}var d=a("kf").Parser,e=a("kity"),f=a("parse/def"),g="_kf_editor_",h="kf-editor-group",i="kf-editor-virtual-group",j=0,k=e.createClass("Parser",{constructor:function(a){this.kfEditor=a,this.callBase(),this.kfParser=d.use("latex"),this.initKFormulExtension(),this.pid=c(),this.groupRecord=0,this.tree=null,this.isResetId=!0,this.initServices()},parse:function(a,c){var d=null;return this.isResetId=!!c,this.isResetId&&this.resetGroupId(),d=this.kfParser.parse(a),b(this,d.tree),d},serialization:function(a){return this.kfParser.serialization(a)},initServices:function(){this.kfEditor.registerService("parser.parse",this,{parse:this.parse}),this.kfEditor.registerService("parser.latex.serialization",this,{serialization:this.serialization})},getKFParser:function(){return this.kfParser},initKFormulExtension:function(){a("kf-ext/extension").ext(this)},resetGroupId:function(){this.groupRecord=0},getGroupId:function(){return this.pid+"_"+ ++this.groupRecord}});return k}),a("position/position",["kity"],function(a){function b(a,c,d){var e=null;return a.ownerSVGElement?(a=a.parentNode,e=a.tagName.toLowerCase(),a&&"body"!==e&&"svg"!==e?"kf-editor-group"===a.getAttribute("data-type")?a:c&&"kf-editor-virtual-group"===a.getAttribute("data-type")?a:d&&null!==a.getAttribute("data-flag")?a:b(a,c,d):null):null}var c=a("kity"),d=c.createClass("PositionComponenet",{constructor:function(a){this.kfEditor=a,this.initServices()},initServices:function(){this.kfEditor.registerService("position.get.group",this,{getGroupByTarget:this.getGroupByTarget}),this.kfEditor.registerService("position.get.parent.group",this,{getParentGroupByTarget:this.getParentGroupByTarget}),this.kfEditor.registerService("position.get.wrap",this,{getWrap:this.getWrap}),this.kfEditor.registerService("position.get.group.info",this,{getGroupInfoByNode:this.getGroupInfoByNode}),this.kfEditor.registerService("position.get.parent.info",this,{getParentInfoByNode:this.getParentInfoByNode})},getGroupByTarget:function(a){var c=b(a,!1,!1);return c?this.kfEditor.requestService("syntax.get.group.content",c.id):null},getParentGroupByTarget:function(a){var c=b(a,!0,!1);return c?this.kfEditor.requestService("syntax.get.group.content",c.id):null},getWrap:function(a){return b(a,!0,!0)},getGroupInfoByNode:function(a){var c=null,d=null;for(d=a;(a=b(a,!0,!1))&&"kf-editor-group"!==a.getAttribute("data-type");)d=a;return c={group:this.kfEditor.requestService("syntax.get.group.content",a.id)},c.index=c.group.content.indexOf(d),c},getParentInfoByNode:function(a){var c=b(a,!0,!1);return c=this.kfEditor.requestService("syntax.get.group.content",c.id),{group:c,index:c.content.indexOf(a)}}});return d}),a("render/render",["kity","kf"],function(a){var b=a("kity"),c=a("kf").Assembly,d={autoresize:!1,fontsize:30,padding:[20,50]},e=b.createClass("RenderComponent",{constructor:function(a){this.kfEditor=a,this.assembly=null,this.formula=null,this.canvasZoom=1,this.record={select:{},cursor:{}},this.initCanvas(),this.initServices(),this.initCommands()},initCanvas:function(){var a=this.kfEditor.requestService("ui.get.canvas.container");this.assembly=c.use(a,d),this.formula=this.assembly.formula},initServices:function(){this.kfEditor.registerService("render.relocation",this,{relocation:this.relocation}),this.kfEditor.registerService("render.select.group.content",this,{selectGroupContent:this.selectGroupContent}),this.kfEditor.registerService("render.select.group",this,{selectGroup:this.selectGroup}),this.kfEditor.registerService("render.select.group.all",this,{selectAllGroup:this.selectAllGroup}),this.kfEditor.registerService("render.select.current.cursor",this,{selectCurrentCursor:this.selectCurrentCursor}),this.kfEditor.registerService("render.reselect",this,{reselect:this.reselect}),this.kfEditor.registerService("render.clear.select",this,{clearSelect:this.clearSelect}),this.kfEditor.registerService("render.set.canvas.zoom",this,{setCanvasZoom:this.setCanvasZoom}),this.kfEditor.registerService("render.get.canvas.zoom",this,{getCanvasZoom:this.getCanvasZoom}),this.kfEditor.registerService("render.get.paper.offset",this,{getPaperOffset:this.getPaperOffset}),this.kfEditor.registerService("render.draw",this,{render:this.render}),this.kfEditor.registerService("render.insert.string",this,{insertString:this.insertString}),this.kfEditor.registerService("render.insert.group",this,{insertGroup:this.insertGroup}),this.kfEditor.registerService("render.get.paper",this,{getPaper:this.getPaper})},initCommands:function(){this.kfEditor.registerCommand("render",this,this.render),this.kfEditor.registerCommand("getPaper",this,this.getPaper)},relocation:function(){var a=this.formula.container.getRenderBox(),b=this.formula.getViewPort();b.center.x=a.width/2,b.center.y=a.height/2,this.formula.setViewPort(b)},selectGroup:function(a){var b=this.kfEditor.requestService("syntax.get.group.object",a),c=this.kfEditor.requestService("syntax.valid.placeholder",a);this.clearSelect(),b.node.getAttribute("data-root")||(c&&(b=this.kfEditor.requestService("syntax.get.group.object",b.operands[0].node.id)),this.record.select.lastSelect=b,b.select())},selectGroupContent:function(a){null!==a.groupObj.getAttribute("data-placeholder")&&(a={id:a.content[0].id});var b=this.kfEditor.requestService("syntax.get.group.object",a.id);this.clearSelect(),this.record.select.lastSelect=b,b.node.getAttribute("data-root")||b.select()},selectAllGroup:function(a){null!==a.groupObj.getAttribute("data-placeholder")&&(a={id:a.content[0].id});var b=this.kfEditor.requestService("syntax.get.group.object",a.id);this.clearSelect(),this.record.select.lastSelect=b,b.selectAll()},selectCurrentCursor:function(){var a=this.kfEditor.requestService("syntax.get.record.cursor"),b=this.kfEditor.requestService("syntax.get.group.object",a.groupId),c=null,d=-1,e=0,f=b.getRenderBox().height,g=Math.min(a.startOffset,a.endOffset),h=Math.max(a.startOffset,a.endOffset);this.clearSelect(),this.record.select.lastSelect=b;for(var i=g,j=h;j>i;i++)c=b.getOperand(i).getRenderBox(),-1==d&&(d=c.x),e+=c.width;b.setBoxSize(e,f),b.selectAll(),b.getBox().translate(d,0)},reselect:function(){var a=this.kfEditor.requestService("syntax.get.record.cursor"),b=null;b=this.kfEditor.requestService("syntax.get.group.object",a.groupId),this.clearSelect(),this.record.select.lastSelect=b,b.node.getAttribute("data-root")||b.select()},clearSelect:function(){var a=null,b=null,c=this.record.select.lastSelect;c&&(c.unselect(),a=c.getRenderBox(),c.setBoxSize(a.width,a.height),b=c.getBox().getTransform(),b&&(b.m.e=0,b.m.f=0),c.getBox().setTransform(b))},getPaper:function(){return this.formula},render:function(a){var b=this.kfEditor.requestService("parser.parse",a,!0),c=this.assembly.regenerateBy(b);this.kfEditor.requestService("syntax.update.objtree",c),this.relocation()},setCanvasZoom:function(a){var b=this.formula.getViewPort();this.canvasZoom=a,b.zoom=a,this.formula.setViewPort(b)},getCanvasZoom:function(){return this.canvasZoom}});return e}),a("syntax/move",["kity"],function(a,b,c){function d(a){var b=null,c=this.parentComponent,d=null;if(a.startOffset===a.endOffset){if(d=c.getGroupContent(a.groupId),o(d.groupObj))return g(this,d.groupObj,r.LEFT);a.startOffset>0?(b=d.content[a.startOffset-1],n(b)?a=f(this,b,r.LEFT):(a.startOffset-=1,a.endOffset=a.startOffset)):a=g(this,d.groupObj,r.LEFT)}else a.startOffset=Math.min(a.startOffset,a.endOffset),a.endOffset=a.startOffset;return a}function e(a){var b=null,c=this.parentComponent,d=null;if(a.startOffset===a.endOffset){if(d=c.getGroupContent(a.groupId),o(d.groupObj))return g(this,d.groupObj,r.RIGHT);a.startOffset<d.content.length?(b=d.content[a.startOffset],n(b)?a=f(this,b,r.RIGHT):(a.startOffset+=1,a.endOffset=a.startOffset)):a=g(this,d.groupObj,r.RIGHT)}else a.endOffset=Math.max(a.startOffset,a.endOffset),a.startOffset=a.endOffset;return a}function f(a,b,c){switch(c){case r.LEFT:return h(a,b);case r.RIGHT:return j(a,b)}throw new Error("undefined move direction!")}function g(a,b,c){switch(c){case r.LEFT:return i(a,b);case r.RIGHT:return k(a,b)}throw new Error("undefined move direction!")}function h(a,b){var c=a.parentComponent,d=null,e=null;if(o(b)||p(b))return i(a,b);if(n(b)){if(d=c.getGroupContent(b.id),e=d.content[d.content.length-1],p(e))return i(a,e);if(m(b))return o(e)?{groupId:e.id,startOffset:0,endOffset:0}:m(e)&&1===d.content.length?h(a,e):{groupId:b.id,startOffset:d.content.length,endOffset:d.content.length};for(;!m(e)&&!p(e)&&!o(e);)d=c.getGroupContent(e.id),e=d.content[d.content.length-1];return p(e)?i(a,e):o(e)?{groupId:e.id,startOffset:d.content.length,endOffset:d.content.length}:h(a,e)}return null}function i(a,b){var c=a.kfEditor,d=(a.parentComponent,null);if(l(b))return null;for(d=c.requestService("position.get.parent.info",b);0===d.index;){if(l(d.group.groupObj))return{groupId:d.group.id,startOffset:0,endOffset:0};if(m(d.group.groupObj)&&d.group.content.length>1)return{groupId:d.group.id,startOffset:0,endOffset:0};d=c.requestService("position.get.parent.info",d.group.groupObj)}return b=d.group.content[d.index-1],n(b)?m(b)?h(a,b):h(a,b):p(b)?i(a,b):{groupId:d.group.id,startOffset:d.index,endOffset:d.index}}function j(a,b){var c=a.parentComponent,d=null,e=null;if(n(b)){if(d=c.getGroupContent(b.id),e=d.content[0],m(b))return m(e)?j(a,e):{groupId:b.id,startOffset:0,endOffset:0};for(;!m(e)&&!o(e)&&!p(e);)d=c.getGroupContent(e.id),e=d.content[0];return o(e)?{groupId:e.id,startOffset:0,endOffset:0}:p(e)?k(a,e):j(a,e)}return null}function k(a,b){var c=a.kfEditor,d=(a.parentComponent,null);if(l(b))return null;for(d=c.requestService("position.get.parent.info",b);d.index===d.group.content.length-1;){if(l(d.group.groupObj))return{groupId:d.group.id,startOffset:d.group.content.length,endOffset:d.group.content.length};if(m(d.group.groupObj)&&d.group.content.length>1)return{groupId:d.group.id,startOffset:d.group.content.length,endOffset:d.group.content.length};d=c.requestService("position.get.parent.info",d.group.groupObj)}return b=d.group.content[d.index+1],p(b)?k(a,b):m(b)?{groupId:b.id,startOffset:0,endOffset:0}:{groupId:d.group.id,startOffset:d.index+1,endOffset:d.index+1}}function l(a){return!!a.getAttribute("data-root")}function m(a){return"kf-editor-group"===a.getAttribute("data-type")}function n(a){var b=a.getAttribute("data-type");return"kf-editor-group"===b||"kf-editor-virtual-group"===b}function o(a){return!!a.getAttribute("data-placeholder")}function p(a){return"Empty"===a.getAttribute("data-flag")}var q=a("kity"),r={LEFT:"left",RIGHT:"right"};return q.createClass("MoveComponent",{constructor:function(a,b){this.parentComponent=a,this.kfEditor=b},leftMove:function(){var a=this.parentComponent.getCursorRecord();a=d.call(this,a),a&&this.parentComponent.updateCursor(a.groupId,a.startOffset,a.endOffset)},rightMove:function(){var a=this.parentComponent.getCursorRecord();a=e.call(this,a),a&&this.parentComponent.updateCursor(a.groupId,a.startOffset,a.endOffset)}})}),a("syntax/syntax",["kity","syntax/move"],function(a){var b=a("kity"),c=a("syntax/move"),d="",e=b.createClass("SyntaxComponenet",{constructor:function(a){this.kfEditor=a,this.record={cursor:{group:null,startOffset:-1,endOffset:-1}},this.components={},this.objTree=null,this.initComponents(),this.initServices()},initComponents:function(){this.components.move=new c(this,this.kfEditor)},initServices:function(){this.kfEditor.registerService("syntax.update.objtree",this,{updateObjTree:this.updateObjTree}),this.kfEditor.registerService("syntax.get.objtree",this,{getObjectTree:this.getObjectTree}),this.kfEditor.registerService("syntax.get.group.object",this,{getGroupObject:this.getGroupObject}),this.kfEditor.registerService("syntax.valid.placeholder",this,{isPlaceholder:this.isPlaceholder}),this.kfEditor.registerService("syntax.valid.brackets",this,{isBrackets:this.isBrackets}),this.kfEditor.registerService("syntax.get.group.content",this,{getGroupContent:this.getGroupContent}),this.kfEditor.registerService("syntax.update.record.cursor",this,{updateCursor:this.updateCursor}),this.kfEditor.registerService("syntax.update.selection",this,{updateSelection:this.updateSelection}),this.kfEditor.registerService("syntax.get.record.cursor",this,{getCursorRecord:this.getCursorRecord}),this.kfEditor.registerService("syntax.get.latex.info",this,{getLatexInfo:this.getLatexInfo}),this.kfEditor.registerService("syntax.insert.string",this,{insertString:this.insertString}),this.kfEditor.registerService("syntax.insert.group",this,{insertGroup:this.insertGroup}),this.kfEditor.registerService("syntax.serialization",this,{serialization:this.serialization}),this.kfEditor.registerService("syntax.cursor.move.left",this,{leftMove:this.leftMove}),this.kfEditor.registerService("syntax.cursor.move.right",this,{rightMove:this.rightMove})},updateObjTree:function(a){var b=a.select;b&&b.groupId&&this.updateCursor(b.groupId,b.startOffset,b.endOffset),this.objTree=a},isPlaceholder:function(a){return!!this.objTree.mapping[a].objGroup.node.getAttribute("data-placeholder")},isBrackets:function(a){return!!this.objTree.mapping[a].objGroup.node.getAttribute("data-brackets")},getObjectTree:function(){return this.objTree},getGroupObject:function(a){return this.objTree.mapping[a].objGroup||null},getCursorRecord:function(){return b.Utils.extend({},this.record.cursor)||null},getGroupContent:function(a){var c=this.objTree.mapping[a],d=[],e=c.objGroup.operands,f=e.length-1,g="rtl"!==c.strGroup.traversal;return b.Utils.each(e,function(a,b){g?d.push(a.node):d[f-b]=a.node}),{id:a,traversal:c.strGroup.traversal||"ltr",groupObj:c.objGroup.node,content:d}},updateSelection:function(a){var b=this.objTree.mapping[a.id],c=b.strGroup,e=null,f=null,g=null,h=-1,i=-1;if(e=a,f=b,"combination"===c.name)this.record.cursor={groupId:e.id,startOffset:0,endOffset:c.operand.length},c.operand.unshift(d),c.operand.push(d);else{for(;"combination"!==f.strGroup.name||1===e.content;)a=e,b=f,e=this.kfEditor.requestService("position.get.parent.group",b.objGroup.node),f=this.objTree.mapping[e.id];var j=[].indexOf.call(e.content,a.groupObj);this.record.cursor={groupId:e.id,startOffset:j,endOffset:j+1},f.strGroup.operand.splice(j+1,0,d),f.strGroup.operand.splice(j,0,d)}return g=this.kfEditor.requestService("parser.latex.serialization",this.objTree.parsedTree),h=g.indexOf(d),g=g.replace(d,""),i=g.indexOf(d),f.strGroup.operand.splice(this.record.cursor.startOffset,1),f.strGroup.operand.splice(this.record.cursor.endOffset,1),{str:g,startOffset:h,endOffset:i}},getLatexInfo:function(){var a=this.record.cursor,b=this.objTree.mapping[a.groupId],c=b.strGroup,e=null,f=-1,g=-1,h=!!c.attr["data-placeholder"];return f=Math.min(a.endOffset,a.startOffset),g=Math.max(a.endOffset,a.startOffset),h?(c=this.kfEditor.requestService("position.get.parent.group",b.objGroup.node),c=this.objTree.mapping[c.id].strGroup,c.operand.unshift(d),c.operand.push(d)):(c.operand.splice(g,0,d),c.operand.splice(f,0,d),g+=1),e=this.kfEditor.requestService("parser.latex.serialization",this.objTree.parsedTree),h?(c.operand.shift(),c.operand.pop()):(c.operand.splice(g,1),c.operand.splice(f,1)),f=e.indexOf(d),e=e.replace(d,""),g=e.lastIndexOf(d),{str:e,startOffset:f,endOffset:g}},updateCursor:function(a,b,c){void 0===c&&(c=b),this.record.cursor={groupId:a,startOffset:b,endOffset:c},window.tt=this.record.cursor},serialization:function(){return this.kfEditor.requestService("parser.latex.serialization",this.objTree.parsedTree)},insertGroup:function(a){var b=this.kfEditor.requestService("parser.parse",a),c=b.tree;this.insertSubtree(c)},leftMove:function(){this.components.move.leftMove()},rightMove:function(){this.components.move.rightMove()},insertSubtree:function(a){var b=this.record.cursor,c=0,d=0,e=null,f=0;this.isPlaceholder(b.groupId)?this.replaceTree(a):(c=Math.min(b.startOffset,b.endOffset),d=Math.max(b.startOffset,b.endOffset),f=d-c,e=this.objTree.mapping[b.groupId].strGroup,e.operand.splice(c,f,a),b.startOffset+=1,b.endOffset=b.startOffset)},replaceTree:function(a){var b=this.record.cursor,c=this.objTree.mapping[b.groupId].objGroup.node,d=this.kfEditor.requestService("position.get.parent.info",c),e=this.objTree.mapping[d.group.id].strGroup;e.operand[d.index]=a,b.groupId=d.group.id,b.startOffset=d.index+1,b.endOffset=d.index+1}});return e}),a("ui/control/zoom",["base/utils","base/common","base/event/event","kity"],function(a){var b=a("base/utils"),c=a("kity"),d={min:.5,max:5},e=c.createClass("ScrollZoomController",{constructor:function(a,c,e,f){this.kfEditor=c,this.target=e,this.zoom=1,this.step=.05,this.options=b.extend({},d,f),this.initEvent()},initEvent:function(){var a=this.kfEditor,c=this,d=this.options.min,e=this.options.max,f=this.step;b.addEvent(this.target,"mousewheel",function(b){b.preventDefault(),b.wheelDelta<0?c.zoom-=c.zoom*f:c.zoom+=c.zoom*f,c.zoom=Math.max(c.zoom,d),c.zoom=Math.min(c.zoom,e),a.requestService("render.set.canvas.zoom",c.zoom)})}});return e}),a("ui/toolbar-ele-list",["ui/ui-impl/def/ele-type","ui/ui-impl/def/box-type","kity"],function(a){var b=a("ui/ui-impl/def/ele-type"),c=a("ui/ui-impl/def/box-type"),d=a("kity"),e=[{type:b.DRAPDOWN_BOX,options:{button:{label:"预设11",icon:"assets/images/toolbar/button/pi.png"},box:{group:[{title:"预设公式",content:[{label:"二次公式",item:{show:'<img src="assets/images/toolbar/ys/1.png">',val:"x=\\frac {-b\\pm\\sqrt {b^2-4ac}}{2a}"}},{label:"二项式定理",item:{show:'<img src="assets/images/toolbar/ys/2.png">',val:"{\\left(x+a\\right)}^2=\\sum^n_{k=0}{\\left(^n_k\\right)x^ka^{n-k}}"}},{label:"勾股定理",item:{show:'<img src="assets/images/toolbar/ys/3.png">',val:"a^2+b^2=c^2"}}]}]}}},{type:b.DELIMITER},{type:b.AREA,options:{button:{icon:"assets/images/toolbar/char/button.png"},box:{width:527,type:c.OVERLAP,group:[{title:"基础数学1",content:[{item:{show:'<img src="assets/images/toolbar/char/math/pm.png">',val:"\\pm"}},{item:{show:'<img src="assets/images/toolbar/char/math/infty.png">',val:"\\infty"}},{item:{show:'<img src="assets/images/toolbar/char/math/eq.png">',val:"="}},{item:{show:'<img src="assets/images/toolbar/char/math/sim.png">',val:"\\sim"}},{item:{show:'<img src="assets/images/toolbar/char/math/times.png">',val:"\\times"}},{item:{show:'<img src="assets/images/toolbar/char/math/div.png">',val:"\\div"}},{item:{show:'<img src="assets/images/toolbar/char/math/tanhao.png">',val:"!"}},{item:{show:'<img src="assets/images/toolbar/char/math/lt.png">',val:"<"}},{item:{show:'<img src="assets/images/toolbar/char/math/ll.png">',val:"\\ll"}},{item:{show:'<img src="assets/images/toolbar/char/math/gt.png">',val:">"}},{item:{show:'<img src="assets/images/toolbar/char/math/gg.png">',val:"\\gg"}},{item:{show:'<img src="assets/images/toolbar/char/math/leq.png">',val:"\\leq"}},{item:{show:'<img src="assets/images/toolbar/char/math/geq.png">',val:"\\geq"}},{item:{show:'<img src="assets/images/toolbar/char/math/mp.png">',val:"\\mp"}},{item:{show:'<img src="assets/images/toolbar/char/math/simeq.png">',val:"\\simeq"}},{item:{show:'<img src="assets/images/toolbar/char/math/equiv.png">',val:"\\equiv"}}]},{title:"希腊字母",content:[]}]}}},{type:b.DELIMITER},{type:b.DRAPDOWN_BOX,options:{button:{label:"分数",icon:"assets/images/toolbar/button/frac.png"},box:{width:378,group:[{title:"分数",content:[{item:{show:'<img src="assets/images/toolbar/frac/1.png">',val:"\\frac \\placeholder\\placeholder"}},{item:{show:'<img src="assets/images/toolbar/frac/2.png">',val:"\\placeholder/\\placeholder"}}]},{title:"常用分数",content:[{item:{show:'<img src="assets/images/toolbar/frac/c1.png">',val:"\\frac {dy}{dx}"}},{item:{show:'<img src="assets/images/toolbar/frac/c2.png">',val:"\\frac {\\Delta y}{\\Delta x}"}},{item:{show:'<img src="assets/images/toolbar/frac/c4.png">',val:"\\frac {\\delta y}{\\delta x}"}},{item:{show:'<img src="assets/images/toolbar/frac/c5.png">',val:"\\frac \\pi 2"}}]}]}}},{type:b.DRAPDOWN_BOX,options:{button:{label:"上下标",icon:"assets/images/toolbar/button/script.png"},box:{width:378,group:[{title:"上标和下标",content:[{item:{show:'<img src="assets/images/toolbar/script/1.png">',val:"\\placeholder^\\placeholder"}},{item:{show:'<img src="assets/images/toolbar/script/2.png">',val:"\\placeholder_\\placeholder"}},{item:{show:'<img src="assets/images/toolbar/script/3.png">',val:"\\placeholder^\\placeholder_\\placeholder"}},{item:{show:'<img src="assets/images/toolbar/script/4.png">',val:"^\\placeholder_\\placeholder\\placeholder"}}]},{title:"常用的上标和下标",content:[{item:{show:'<img src="assets/images/toolbar/script/c1.png">',val:"e^{-i\\omega t}"}},{item:{show:'<img src="assets/images/toolbar/script/c2.png">',val:"x^2"}},{item:{show:'<img src="assets/images/toolbar/script/c3.png">',val:"^n_1Y"}}]}]}}},{type:b.DRAPDOWN_BOX,options:{button:{label:"根式",icon:"assets/images/toolbar/button/sqrt.png"},box:{width:378,group:[{title:"根式",content:[{item:{show:'<img src="assets/images/toolbar/sqrt/1.png">',val:"\\sqrt \\placeholder"}},{item:{show:'<img src="assets/images/toolbar/sqrt/2.png">',val:"\\sqrt [\\placeholder] \\placeholder"}},{item:{show:'<img src="assets/images/toolbar/sqrt/3.png">',val:"\\sqrt [2] \\placeholder"}},{item:{show:'<img src="assets/images/toolbar/sqrt/4.png">',val:"\\sqrt [3] \\placeholder"}}]},{title:"常用根式",content:[{item:{show:'<img src="assets/images/toolbar/sqrt/c1.png">',val:"\\frac {-b\\pm\\sqrt{b^2-4ac}}{2a}"}},{item:{show:'<img src="assets/images/toolbar/sqrt/c2.png">',val:"\\sqrt {a^2+b^2}"}}]}]}}},{type:b.DRAPDOWN_BOX,options:{button:{label:"括号",icon:"assets/images/toolbar/button/brackets.png"},box:{width:378,group:[{title:"方括号",content:[{item:{show:'<img src="assets/images/toolbar/brackets/1.png">',val:"\\left(\\placeholder\\right)"}},{item:{show:'<img src="assets/images/toolbar/brackets/2.png">',val:"\\left[\\placeholder\\right]"}},{item:{show:'<img src="assets/images/toolbar/brackets/3.png">',val:"\\left\\{\\placeholder\\right\\}"}},{item:{show:'<img src="assets/images/toolbar/brackets/4.png">',val:"\\left|\\placeholder\\right|"}}]}]}}}];return function(){var a=["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"],b=e[2].options.box.group[1].content;d.Utils.each(a,function(a,c){b.push({item:{show:'<img src="assets/images/toolbar/char/greek/'+a+'.png">',val:"\\"+a}})})}(),e}),a("ui/toolbar/toolbar",["kity","ui/ui-impl/ui","ui/ui-impl/drapdown-box","ui/ui-impl/delimiter","ui/ui-impl/area","ui/ui-impl/ui-utils","jquery","ui/ui-impl/def/ele-type"],function(a){function b(a,b,f){switch(a){case i.DRAPDOWN_BOX:return c(b,f);case i.DELIMITER:return d(b);case i.AREA:return e(b,f)}}function c(a,b){return new g.DrapdownBox(a,b)}function d(a){return new g.Delimiter(a)}function e(a,b){return new g.Area(a,b)}var f=a("kity"),g=a("ui/ui-impl/ui"),h=a("ui/ui-impl/ui-utils"),i=a("ui/ui-impl/def/ele-type"),j=f.createClass("Tollbar",{constructor:function(a,b,c){this.kfEditor=a,this.uiComponent=b,this.elementList=c,this.elements=[],this.initToolbarElements(),this.initEvent()},initEvent:function(){var a=this;h.on(this.kfEditor.getContainer(),"mousedown",function(){a.notify("closeAll")}),h.subscribe("data.select",function(b){a.insertSource(b)})},insertSource:function(a){this.kfEditor.requestService("control.insert.group",a)},notify:function(a){switch(a){case"closeAll":case"closeOther":return void this.closeElement(arguments[1])}},closeElement:function(a){f.Utils.each(this.elements,function(b){b!=a&&b.hide&&b.hide()})},initToolbarElements:function(){var a=this.elements,c=this.uiComponent.toolbarContainer.ownerDocument,d=this;f.Utils.each(this.elementList,function(e,f){var g=b(e.type,c,e.options);a.push(g),d.appendElement(g)})},appendElement:function(a){a.setToolbar(this),a.attachTo(this.uiComponent.toolbarContainer)}});return j}),a("ui/ui-impl/area",["kity","ui/ui-impl/ui-utils","jquery","ui/ui-impl/box","ui/ui-impl/def/box-type","ui/ui-impl/def/item-type","ui/ui-impl/button","ui/ui-impl/list"],function(a){var b=a("kity"),c="kf-editor-ui-",d=a("ui/ui-impl/ui-utils"),e=a("ui/ui-impl/box"),f=b.createClass("Area",{constructor:function(a,b){this.options=b,this.doc=a,this.toolbar=null,this.element=this.createArea(),this.container=this.createContainer(),this.button=this.createButton(),this.mountPoint=this.createMountPoint(),this.boxObject=this.createBox(),this.mergeElement(),this.mount(),this.setListener(),this.initEvent(),this.updateContent()},initEvent:function(){var a=this;d.on(this.button,"click",function(){a.showMount()}),d.delegate(this.container,".kf-editor-ui-area-item","mousedown",function(a){a.preventDefault(),1===a.which&&d.publish("data.select",this.getAttribute("data-value"))}),this.boxObject.initEvent()},setListener:function(){var a=this;this.boxObject.setSelectHandler(function(b){d.publish("data.select",b),a.hide()}),this.boxObject.setChangeHandler(function(b){a.updateContent()})},createArea:function(){var a=d.ele(this.doc,"div",{className:c+"area"});return"width"in this.options&&(a.style.width=this.options.width+"px"),
a},updateContent:function(){var a=this.boxObject.getOverlapContent(),d=[];this.container.innerHTML="",b.Utils.each(a,function(a,b){a=a.item,d.push('<div class="'+c+'area-item" data-value="'+a.val+'"><div class="'+c+'area-item-content">'+a.show+"</div></div>")}),this.container.innerHTML=d.join("")},mount:function(){this.boxObject.mountTo(this.mountPoint)},showMount:function(){this.mountPoint.style.display="block"},hideMount:function(){this.mountPoint.style.display="none"},hide:function(){this.hideMount(),this.boxObject.hide()},createButton:function(){return d.ele(this.doc,"div",{className:c+"area-button",content:"▼"})},createMountPoint:function(){return d.ele(this.doc,"div",{className:c+"area-mount"})},createBox:function(){return new e(this.doc,this.options.box)},createContainer:function(){var a=d.ele(this.doc,"div",{className:c+"area-container"});return a},mergeElement:function(){this.element.appendChild(this.container),this.element.appendChild(this.button),this.element.appendChild(this.mountPoint)},setToolbar:function(a){this.toolbar=a},attachTo:function(a){a.appendChild(this.element)}});return f}),a("ui/ui-impl/box",["kity","ui/ui-impl/ui-utils","jquery","ui/ui-impl/def/box-type","ui/ui-impl/def/item-type","ui/ui-impl/button","ui/ui-impl/list"],function(a){function b(a,b,c){var d=[];return f.Utils.each(b,function(b,e){d.push(new n(c,a,b))}),d}function c(a){return h.ele(a,"div",{className:g+"overlap-container"})}function d(a){return new k(a,{sign:!1,className:"overlap-button",label:""})}function e(a,b){return new l(a,b)}var f=a("kity"),g="kf-editor-ui-",h=a("ui/ui-impl/ui-utils"),i=a("ui/ui-impl/def/box-type"),j=a("ui/ui-impl/def/item-type"),k=a("ui/ui-impl/button"),l=a("ui/ui-impl/list"),m=f.createClass("Box",{constructor:function(a,b){this.options=b,this.options.type=this.options.type||i.DETACHED,this.doc=a,this.overlapButtonObject=null,this.overlapIndex=-1,this.element=this.createBox(),this.groupContainer=this.createGroupContainer(),this.itemGroups=this.createItemGroup(),this.mergeElement()},createBox:function(){var a=h.ele(this.doc,"div",{className:g+"box"});return"width"in this.options&&(a.style.width=this.options.width+"px"),a},initEvent:function(){var a="."+g+"box-item",b=this;h.delegate(this.groupContainer,a,"mousedown",function(a){a.preventDefault(),1===a.which&&b.onselectHandler&&b.onselectHandler(this.getAttribute("data-value"))}),h.on(this.element,"mousedown",function(a){a.stopPropagation(),a.preventDefault()})},getNode:function(){return this.element},setSelectHandler:function(a){this.onselectHandler=a},setChangeHandler:function(a){this.onchangeHandler=a},onchangeHandler:function(a){},createGroupContainer:function(){return h.ele(this.doc,"div",{className:g+"box-container"})},createItemGroup:function(){var a=this.createGroup();switch(this.options.type){case i.DETACHED:return a;case i.OVERLAP:return this.createOverlapGroup(a)}return null},hide:function(){this.overlapButtonObject&&this.overlapButtonObject.hideMount()},getOverlapContent:function(){return this.options.type!==i.OVERLAP?null:this.options.group[this.overlapIndex].content},createOverlapGroup:function(a){var b=this.getGroupList(),g=this,h=c(this.doc),i=d(this.doc),j=e(this.doc,b);return this.overlapButtonObject=i,i.mount(j),i.initEvent(),j.initEvent(),j.setSelectHandler(function(c,d){g.overlapIndex=c,i.setLabel(b.items[c]+" ▼"),i.hideMount(),a[d].style.display="none",a[c].style.display="block",g.onchangeHandler(c)}),h.appendChild(i.getNode()),f.Utils.each(a,function(a,b){b>0&&(a.style.display="none"),h.appendChild(a)}),j.select(0),[h]},getGroupList:function(){var a=[];return f.Utils.each(this.options.group,function(b,c){a.push(b.title)}),{width:150,items:a}},createGroup:function(){var a=this.doc,c=[],d=null,e=null,k=i.DETACHED===this.options.type?j.BIG:j.SMALL,l=null;return d=h.ele(this.doc,"div",{className:g+"box-group"}),l=d.cloneNode(!1),l.className=g+"box-group-item-container",f.Utils.each(this.options.group,function(i,j){d=d.cloneNode(!1),l=l.cloneNode(!1),e=h.ele(a,"div",{className:g+"box-group-title",content:i.title}),d.appendChild(e),d.appendChild(l),f.Utils.each(b(a,i.content,k),function(a){a.appendTo(l)}),c.push(d)}),c},mergeElement:function(){var a=this.groupContainer;this.element.appendChild(a),f.Utils.each(this.itemGroups,function(b){a.appendChild(b)})},mountTo:function(a){a.appendChild(this.element)},appendTo:function(a){a.appendChild(this.element)}}),n=f.createClass("BoxItem",{constructor:function(a,b,c){this.type=a,this.doc=b,this.options=c,this.element=this.createItem(),this.labelNode=this.createLabel(),this.contentNode=this.createContent(),this.mergeElement()},getNode:function(){return this.element},createItem:function(){var a=h.ele(this.doc,"div",{className:g+"box-item"});return a},createLabel:function(){var a=null;if("label"in this.options)return a=h.ele(this.doc,"div",{className:g+"box-item-label",content:this.options.label})},getContent:function(){},createContent:function(){switch(this.type){case j.BIG:return this.createBigContent();case j.SMALL:return this.createSmallContent()}},createBigContent:function(){var a=this.doc,b=h.ele(a,"div",{className:g+"box-item-content"}),c=g+"box-item-val",d=this.options.item,e=null;return"string"==typeof d&&(d={show:d,val:d}),e=h.ele(a,"div",{className:c}),e.innerHTML=d.show,this.element.setAttribute("data-value",d.val),b.appendChild(e),b},createSmallContent:function(){var a=this.doc,b=h.ele(a,"div",{className:g+"box-item-content"}),c=g+"box-item-val",d=this.options.item,e=null;return"string"==typeof d&&(d={show:d,val:d}),e=h.ele(a,"div",{className:c}),e.innerHTML=d.show,this.element.setAttribute("data-value",d.val),b.appendChild(e),b},mergeElement:function(){this.labelNode&&this.element.appendChild(this.labelNode),this.element.appendChild(this.contentNode)},appendTo:function(a){a.appendChild(this.element)}});return m}),a("ui/ui-impl/button",["kity","ui/ui-impl/ui-utils","jquery"],function(a){var b=a("kity"),c="kf-editor-ui-",d=a("ui/ui-impl/ui-utils"),e=b.createClass("Button",{constructor:function(a,b){this.options=b,this.eventState=!1,this.doc=a,this.element=this.createButton(),this.icon=this.createIcon(),this.label=this.createLabel(),this.sign=this.createSign(),this.mountPoint=this.createMountPoint(),this.mergeElement()},initEvent:function(){var a=this;this.eventState||(this.eventState=!0,d.on(this.element,"mousedown",function(b){b.preventDefault(),b.stopPropagation(),1===b.which&&(a.toggleSelect(),a.toggleMountElement())}))},toggleMountElement:function(){var a=this.mountPoint.style.display||"none";this.mountPoint.style.display="none"===a?"block":"none"},setLabel:function(a){this.label.innerHTML=a},toggleSelect:function(){this.element.classList.toggle(c+"button-in")},unselect:function(){this.element.classList.remove(c+"button-in")},select:function(){this.element.classList.add(c+"button-in")},show:function(){this.select(),this.showMount()},hide:function(){this.unselect(),this.hideMount()},showMount:function(){this.mountPoint.style.display="block"},hideMount:function(){this.mountPoint.style.display="none"},getNode:function(){return this.element},mount:function(a){a.mountTo(this.mountPoint)},createButton:function(){var a=d.ele(this.doc,"div",{className:c+"button"});return this.options.className&&(a.className+=" "+c+this.options.className),a},createIcon:function(){if(!this.options.icon)return null;var a=d.ele(this.doc,"div",{className:c+"button-icon"});return a.style.backgroundImage="url("+this.options.icon+")",a},createLabel:function(){var a=d.ele(this.doc,"div",{className:c+"button-label",content:this.options.label});return a},createSign:function(){return this.options.sign?d.ele(this.doc,"div",{className:c+"button-sign"}):null},createMountPoint:function(){return d.ele(this.doc,"div",{className:c+"button-mount-point"})},mergeElement:function(){this.icon&&this.element.appendChild(this.icon),this.element.appendChild(this.label),this.sign&&this.element.appendChild(this.sign),this.element.appendChild(this.mountPoint)}});return e}),a("ui/ui-impl/def/box-type",[],function(a){return{DETACHED:1,OVERLAP:2}}),a("ui/ui-impl/def/ele-type",[],function(a){return{DRAPDOWN_BOX:1,AREA:2,DELIMITER:3}}),a("ui/ui-impl/def/item-type",[],function(a){return{BIG:1,SMALL:2}}),a("ui/ui-impl/delimiter",["kity","ui/ui-impl/ui-utils","jquery"],function(a){var b=a("kity"),c="kf-editor-ui-",d=a("ui/ui-impl/ui-utils"),e=b.createClass("Delimiter",{constructor:function(a){this.doc=a,this.element=this.createDilimiter()},setToolbar:function(a){},createDilimiter:function(){var a=d.ele(this.doc,"div",{className:c+"delimiter"});return a.appendChild(d.ele(this.doc,"div",{className:c+"delimiter-line"})),a},attachTo:function(a){a.appendChild(this.element)}});return e}),a("ui/ui-impl/drapdown-box",["kity","ui/ui-impl/ui-utils","jquery","ui/ui-impl/button","ui/ui-impl/box","ui/ui-impl/def/box-type","ui/ui-impl/def/item-type","ui/ui-impl/list"],function(a){var b=a("kity"),c=a("ui/ui-impl/ui-utils"),d=a("ui/ui-impl/button"),e=a("ui/ui-impl/box"),f=b.createClass("DrapdownBox",{constructor:function(a,b){this.options=b,this.toolbar=null,this.doc=a,this.buttonElement=this.createButton(),this.element=this.buttonElement.getNode(),this.boxElement=this.createBox(),this.buttonElement.mount(this.boxElement),this.initEvent()},initEvent:function(){var a=this;c.on(this.element,"mousedown",function(b){b.preventDefault(),b.stopPropagation(),a.toolbar.notify("closeOther",a)}),this.buttonElement.initEvent(),this.boxElement.initEvent(),this.boxElement.setSelectHandler(function(b){c.publish("data.select",b),a.buttonElement.hide()})},setToolbar:function(a){this.toolbar=a},createButton:function(){return new d(this.doc,this.options.button)},show:function(){this.buttonElement.show()},hide:function(){this.buttonElement.hide()},createBox:function(){return new e(this.doc,this.options.box)},attachTo:function(a){a.appendChild(this.element)}});return f}),a("ui/ui-impl/list",["kity","ui/ui-impl/ui-utils","jquery"],function(a){var b=a("kity"),c="kf-editor-ui-",d=a("ui/ui-impl/ui-utils"),e=b.createClass("List",{constructor:function(a,b){this.options=b,this.doc=a,this.onselectHandler=null,this.currentSelect=-1,this.element=this.createBox(),this.itemGroups=this.createItems(),this.mergeElement()},onselectHandler:function(a,b){},setSelectHandler:function(a){this.onselectHandler=a},createBox:function(){var a=d.ele(this.doc,"div",{className:c+"list"}),b=d.ele(this.doc,"div",{className:c+"list-bg"});return"width"in this.options&&(a.style.width=this.options.width+"px"),a.appendChild(b),a},select:function(a){var b=this.currentSelect;-1===b&&(b=a),this.unselect(b),this.currentSelect=a,this.itemGroups.items[a].firstChild.style.visibility="visible",this.onselectHandler(a,b)},unselect:function(a){this.itemGroups.items[a].firstChild.style.visibility="hidden"},initEvent:function(){var a="."+c+"list-item",b=this;d.delegate(this.itemGroups.container,a,"mousedown",function(a){a.preventDefault(),1===a.which&&b.select(this.getAttribute("data-index"))}),d.on(this.element,"mousedown",function(a){a.stopPropagation(),a.preventDefault()})},createItems:function(){var a=this.doc,e=null,f=null,g=null,h=[],i=null;return e=d.ele(this.doc,"div",{className:c+"list-item"}),i=e.cloneNode(!1),i.className=c+"list-item-container",b.Utils.each(this.options.items,function(b,j){f=e.cloneNode(!1),g=e.cloneNode(!1),g.className=c+"list-item-icon",g.innerHTML='<img src="assets/images/toolbar/button/tick.png">',f.appendChild(g),f.appendChild(d.ele(a,"text",b)),f.setAttribute("data-index",j),h.push(f),i.appendChild(f)}),{container:i,items:h}},mergeElement:function(){this.element.appendChild(this.itemGroups.container)},mountTo:function(a){a.appendChild(this.element)}});return e}),a("ui/ui-impl/ui-utils",["jquery","kity"],function(a){var b=a("jquery"),c=a("kity"),d={};return{ele:function(a,b,c){var d=null;return"text"===b?a.createTextNode(c):(d=a.createElement(b),c.className&&(d.className=c.className),c.content&&(d.innerHTML=c.content),d)},on:function(a,c,d){return b(a).on(c,d),this},delegate:function(a,c,d,e){return b(a).delegate(c,d,e),this},publish:function(a,b){var e=d[a];e&&(b=[].slice.call(arguments,1),c.Utils.each(e,function(a){a.apply(null,b)}))},subscribe:function(a,b){d[a]||(d[a]=[]),d[a].push(b)}}}),a("ui/ui-impl/ui",["ui/ui-impl/drapdown-box","kity","ui/ui-impl/ui-utils","ui/ui-impl/button","ui/ui-impl/box","ui/ui-impl/delimiter","ui/ui-impl/area"],function(a){return{DrapdownBox:a("ui/ui-impl/drapdown-box"),Delimiter:a("ui/ui-impl/delimiter"),Area:a("ui/ui-impl/area")}}),a("ui/ui",["kity","base/utils","base/common","base/event/event","ui/toolbar/toolbar","ui/ui-impl/ui","ui/ui-impl/ui-utils","ui/ui-impl/def/ele-type","ui/control/zoom","ui/toolbar-ele-list","ui/ui-impl/def/box-type"],function(a,b,c){function d(a){var b=a.createElement("div");return b.className="kf-editor-toolbar",b}function e(a){var b=a.createElement("div");return b.className="kf-editor-edit-area",b.style.width="80%",b.style.height="800px",b}function f(a){var b=a.createElement("div");return b.className="kf-editor-canvas-container",b}var g=a("kity"),h=a("base/utils"),i=a("ui/toolbar/toolbar"),j=a("ui/control/zoom"),k=a("ui/toolbar-ele-list"),l=g.createClass("UIComponent",{constructor:function(a){var b=null;this.container=a.getContainer(),b=this.container.ownerDocument,this.components={},this.kfEditor=a,this.resizeTimer=null,this.toolbarContainer=d(b),this.editArea=e(b),this.canvasContainer=f(b),this.updateContainerSize(this.container,this.toolbarContainer,this.editArea,this.canvasContainer),this.container.appendChild(this.toolbarContainer),this.editArea.appendChild(this.canvasContainer),this.container.appendChild(this.editArea),this.initCanvas(),this.initComponents(),this.initServices(),this.initResizeEvent()},initComponents:function(){this.components.toolbar=new i(this.kfEditor,this,k),this.components.scrollZoom=new j(this,this.kfEditor,this.canvasContainer)},initCanvas:function(){},updateContainerSize:function(a,b,c,d){var e=a.getBoundingClientRect();b.style.width=e.width-12+"px",b.style.height="80px",c.style.marginTop="80px",c.style.width=e.width+"px",c.style.height=e.height-80+"px"},initServices:function(){this.kfEditor.registerService("ui.get.canvas.container",this,{getCanvasContainer:m.getCanvasContainer}),this.kfEditor.registerService("ui.canvas.container.event",this,{on:m.addEvent,off:m.removeEvent,trigger:m.trigger,fire:m.trigger})},initResizeEvent:function(){var a=this;this.canvasContainer.ownerDocument.defaultView.onresize=function(){window.clearTimeout(a.resizeTimer),a.resizeTimer=window.setTimeout(function(){a.kfEditor.requestService("render.relocation")},80)}}}),m={getCanvasContainer:function(){return this.canvasContainer},addEvent:function(a,b){h.addEvent(this.canvasContainer,a,b)},removeEvent:function(){},trigger:function(a){h.trigger(this.canvasContainer,a)}};return l}),function(b){a("kf.start",function(a){var b=a("editor/editor");b.registerComponents("ui",a("ui/ui")),b.registerComponents("parser",a("parse/parser")),b.registerComponents("render",a("render/render")),b.registerComponents("position",a("position/position")),b.registerComponents("syntax",a("syntax/syntax")),kf.Editor=b});try{c("kf.start")}catch(d){}}(this)}();